<?xml version="1.0"?>
<robot name="robotic_arm" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:property name="mesh_package" value="package://rover_arm/meshes/" />

  <!-- Material Definitions -->
  <material name="mat_silver">
    <color rgba="0.8 0.8 0.8 1"/>
  </material>
  <!--Some inertial calculations-->
  
    <xacro:macro name="inertial_box" params="mass x y z *origin">
        <inertial>
            <xacro:insert_block name="origin" />
            <mass value="${mass}" />
            <inertia ixx="${(1/12) * mass * (y*y+z*z)}" ixy="0.0" ixz="0.0" iyy="${(1/12) * mass * (x*x+z*z)}" iyz="0.0" izz="${(1/12) * mass * (x*x+y*y)}" />
        </inertial>
    </xacro:macro>
    
  <link name="world" />
 

  <!-- Base Link -->
  <link name="base_link">
    
    <visual>
      <origin xyz="0 0 0.07" rpy="3.1415 0 0"/>
      <geometry>
        <mesh filename="${mesh_package}Joint1.stl" scale="1 1 1"/>
      </geometry>
      <material name="mat_silver"/>
    </visual>
    <visual>
      <origin xyz="0.03 0.017 0.23" rpy="-1.5707 0.16 0"/>
      <geometry>
        <mesh filename="${mesh_package}Connector1.stl" scale="1 1 1"/>
      </geometry>
      <material name="mat_silver"/>
    </visual>
    <collision>
       <origin xyz="0.022 0 0.16" rpy="0 0 0" />
      <geometry>
       <box size="0.16 0.16 0.32" />
      </geometry>
    </collision>
     <xacro:inertial_box mass="10" x="0.16" y="0.16" z="0.32">
        <origin xyz="0.022 0 0.16" rpy="0 0 0" />
     </xacro:inertial_box>
    
  </link>
  <link name="link1">
    <!-- Has joint 2, link 1, and connector 2; is controlled by a revolute joint of pi freedom on y or x axis (tbd). -->
    <visual>
        <origin xyz="0 0 0" rpy="-1.568 1.22 0 " />
        <geometry>
            <mesh filename="${mesh_package}Joint2.stl" scale="1 1 1"/>
        </geometry>
        <material name="mat_silver" />
    </visual>
    <visual>
        <origin xyz="0 0.01 0.19" rpy="-1.56 0 0" />
        <geometry>
            <mesh filename="${mesh_package}Link1.stl" scale="1 1 1"/>
        </geometry>
        <material name="mat_silver" />
    </visual>
    <visual>
        <origin xyz="0 0 0.363" rpy="1.568 0 0" />
        <geometry>
            <mesh filename="${mesh_package}Connector2.stl" scale="1 1 1"/>
        </geometry>
        <material name="mat_silver" />
    </visual>
    <collision>
      <origin xyz="0.03 0.2 0.42" rpy="0 0 0" />
      <geometry>
       <box size="0.16 0.14 0.53" />
      </geometry>
    </collision>
     <xacro:inertial_box mass="0.1" x="0.16" y="0.14" z="0.53">
        <origin xyz="0.03 0.2 0.42" rpy="0 0 0" />
     </xacro:inertial_box>
</link>
<link name="link2">
        <!-- Has joint 3, link 2 and connector 3, is controlled by a revolute joint of pi freedom on y or x axis (tbd). -->
    <visual>
      <origin xyz="0.01 0.1 0" rpy="1.57 -0.22 0" />
      <geometry>
        <mesh filename="${mesh_package}Joint3.stl" scale="1 1 1"/>
      </geometry>
      <material name="mat_silver" />
  </visual>
    <visual>
       <origin xyz="0.14 0.09 0" rpy="0 0 1.56" />
      <geometry>
        <mesh filename="${mesh_package}Link2.stl" scale="1 1 1"/>
      </geometry>
       <material name="mat_silver" />
   </visual>
    <visual>
      <origin xyz="0.26 0.07 0" rpy="1.55 -1.38 0" />
      <geometry>
         <mesh filename="${mesh_package}Connector3.stl" scale="1 1 1"/>
      </geometry>
       <material name="mat_silver" />
   </visual>
  <collision>
      <origin xyz="0.155 0 0.61" rpy="0 0 0" />
      <geometry>
           <box size="0.395 0.15 0.15" />
      </geometry>
   </collision>
   <xacro:inertial_box mass="0.1" x="0.395" y="0.15" z="0.15">
        <origin xyz="0.155 0 0.61" rpy="0 0 0" />
   </xacro:inertial_box>
 
</link>
<link name="link3">
        <!-- Has joint 4 and a possible end effector, is controlled by a revolute joint of pi freedom on x or y axis (tbd).-->
       
    <visual>
       <origin xyz="-0.39 0 0.194" rpy="1.557 2 0" />
       <geometry>
        <mesh filename="${mesh_package}Joint4.stl" scale="1 1 1"/>
      </geometry>
       <material name="mat_silver" />
  </visual>
  <collision>
        <origin xyz="0.29 0.16 0.62" rpy="0 0 0" />
       <geometry>
           <box size="0.15 0.15 0.17" />
      </geometry>
  </collision>
  <xacro:inertial_box mass="0.1" x="0.15" y="0.15" z="0.17">
         <origin xyz="0.29 0.16 0.62" rpy="0 0 0" />
   </xacro:inertial_box>
 
</link>

<joint name="joint1" type="continuous">
        <parent link="world" />
        <child link="base_link" />
        <origin xyz="0 0 0" rpy="0 0 0" />
        <axis xyz="0 0 1" />
        <limit velocity="100" effort="100" />
</joint>
<joint name="joint2" type="revolute">
        <parent link="base_link" />
        <child link="link1" />
        <origin xyz="0.03 0.18 0.24" rpy="0 0 0" />
        <axis xyz="0 -1 0" />
        <limit lower="-1.5707" upper="0" velocity="100" effort="100" />
</joint>
<joint name="joint3" type="revolute">
        <parent link="link1" />
        <child link="link2" />
        <origin xyz="0 -0.24 0.37" rpy="0 0 0" />
        <axis xyz="0 1 0" />
        <limit lower="0" upper="1.5707" velocity="100" effort="100" />
    </joint>
 <joint name="joint4" type="revolute">
        <parent link="link2" />
        <child link="link3" />
        <origin xyz="0.25 0.2 0" rpy="0 0 0" />
        <axis xyz="0 1 0" />
        <limit lower="-1.5707" upper="0" velocity="100" effort="100" />
    </joint>
   
    <gazebo reference="base_link">
        <material>Gazebo/Green</material>
        
    </gazebo>
    <gazebo reference="link1">
        <material>Gazebo/Blue</material>
    </gazebo>
    <gazebo reference="link2">
        <material>Gazebo/Orange</material>
    </gazebo>
    <gazebo reference="link3">
        <material>Gazebo/Red</material>
    </gazebo>
   <gazebo>
    <plugin name="joint1_control" filename="libgazebo_ros_control.so">
      <joint>joint1</joint>
      <commandTopic>/joint1/command</commandTopic>
    </plugin>
    <plugin name="joint2_control" filename="libgazebo_ros_control.so">
      <joint>joint2</joint>
      <commandTopic>/joint2/command</commandTopic>
    </plugin>
    <plugin name="joint3_control" filename="libgazebo_ros_control.so">
      <joint>joint3</joint>
      <commandTopic>/joint3/command</commandTopic>
    </plugin>
    <plugin name="joint4_control" filename="libgazebo_ros_control.so">
      <joint>joint4</joint>
      <commandTopic>/joint4/command</commandTopic>
    </plugin>
  </gazebo>
  <gazebo>
    <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so"/>
  </gazebo>


  </robot>